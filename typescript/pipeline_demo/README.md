# Welcome to your CDK TypeScript project

CDK example to create a cross account CodePipeline with two stages , Source stage as CodeCommit repository from another account and CodeBuild stage is same as that of Pipeline account. 

We have few examples with Cross account configuration however we do not have any existing example with cross account source as a source.

For cross account setup we need following:

1. Cross account action role that has required permissions on the CodeCommit repository , KMS key and pipeline artifact S3 bucket 
2. Custom managed KMS key that allows both CodePipeline service role and Cross account role access.
3. S3 bucket policy to allow put and get permissions for Cross Account role.


## Prerequisites 


1. Ensure that cross-account permissions are properly configured between pipeline account and codecommit account to allow access to the CodeCommit repository.


The example creates a CodePipeline with two stages CodeCommit from another account and Build stage same as pipeline account. The code takes care of creating Custom manged key and adding key policy that allows both pipeline role and cross account role. Also, Pipeline S3 bucket policy has permissions for Cross account role.  

## Furture Improvemts

With current example CodePipeline is automatically triggered based on Polling method. That is when a user make any commit, pipeline keeps polling for source and when it receives the changes the pipeline is triggered. 
```bash
trigger=cpactions.CodeCommitTrigger.POLL
```

## Language

Typescript

## Build

To build this app, you need to be in this example's root folder. Then run the following:

```bash
npm install -g aws-cdk
npm install
npm run build
```

This will install the necessary CDK, then this example's dependencies, and then build your TypeScript files and your CloudFormation template.

## Deploy

Run `cdk deploy`. This will deploy / redeploy your Stack to your AWS Account.


## Synthesize Cloudformation Template

To see the Cloudformation template generated by the CDK, run `cdk synth`, then check the output file in the "cdk.out" directory.


